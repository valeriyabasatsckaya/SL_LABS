import shelve

phones = {
    "iPhone 14": {
        "США": 999, "Великобритания": 949, "Германия": 1099,
        "Франция": 1049, "Китай": 8999, "Япония": 129800,
        "Индия": 89900, "Россия": 89990
    },
    "Samsung S23": {
        "США": 799, "Великобритания": 769, "Германия": 849,
        "Франция": 819, "Китай": 5999, "Япония": 99800,
        "Индия": 69900, "Россия": 74990
    },
    "Google Pixel 8": {
        "США": 699, "Великобритания": 679, "Германия": 749,
        "Франция": 729, "Китай": 5499, "Япония": 104800,
        "Индия": 64900, "Россия": 72990
    },
    "Xiaomi 14": {
        "США": 899, "Великобритания": 849, "Германия": 899,
        "Франция": 879, "Китай": 4499, "Япония": 119800,
        "Индия": 59999, "Россия": 84990
    },
    "OnePlus 12": {
        "США": 799, "Великобритания": 749, "Германия": 799,
        "Франция": 779, "Китай": 5299, "Япония": 114800,
        "Индия": 62999, "Россия": 77990
    },
    "Motorola Edge 50": {
        "США": 599, "Великобритания": 579, "Германия": 629,
        "Франция": 609, "Китай": 3999, "Япония": 89800,
        "Индия": 49999, "Россия": 64990
    },
    "Sony Xperia 5 V": {
        "США": 999, "Великобритания": 949, "Германия": 999,
        "Франция": 979, "Китай": 7999, "Япония": 148000,
        "Индия": 99900, "Россия": 109900
    }
}

# 2. Вывод всех телефонов и их средних стоимостей
print("\nВсе телефоны и их средняя стоимость:")
avg_prices = {}
for model, prices in phones.items():
    avg = sum(prices.values()) / len(prices)
    avg_prices[model] = avg
    print(f"{model:<20} → {avg:,.2f}")

# 3. Удаляем телефон с минимальной средней стоимостью
min_model = min(avg_prices, key=avg_prices.get)
del phones[min_model]
print(f"\nУдалён телефон с минимальной средней стоимостью: {min_model}")

# 4. Обновляем средние для оставшихся
remaining_avg = {model: sum(prices.values()) / len(prices) for model, prices in phones.items()}
max_avg = max(remaining_avg.values())
threshold = max_avg * 0.7  # 30% ниже максимума = 70% от максимума

print("\nТелефоны, средняя стоимость которых ≥ 70% от максимальной:")
for model, avg in remaining_avg.items():
    if avg >= threshold:
        print(model)

# 5. Телефоны, которые дороже в США, чем в Великобритании
print("\nТелефоны, стоимость которых в США > стоимости в Великобритании:")
us_uk_cheaper = {}
for model, prices in phones.items():
    if prices["США"] > prices["Великобритания"]:
        us_uk_cheaper[model] = prices
        print(f"  • {model}")

# 6. Сохраняем результат в shelve
with shelve.open('result_phones') as shelf:
    shelf['phones_us_more_than_uk'] = us_uk_cheaper

print("\nСловарь сохранён в файл 'result_phones' (с использованием модуля shelve).")